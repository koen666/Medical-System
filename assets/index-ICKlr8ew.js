import{_ as k,B as y,a as n,b as s,f as p,g,t as d,d as u,F as f,e as m,o,n as b}from"./index-C6aXvd6r.js";const z=y({name:"KnowledgeBase",data(){return{API_BASE:"http://localhost:5000/api",loading:!1,error:null,Graph:null,nodeCount:0,linkCount:0,selectedTemplate:1,chainTemplates:[{id:1,name:"标准诊断思维链",icon:"🏥",description:"通用诊断流程：症状分析 → 疾病匹配 → 鉴别诊断",tags:["通用","诊断"]},{id:2,name:"康复治疗思维链",icon:"🏃‍♂️",description:"康复流程：病情评估 → 治疗方法 → 药物选择 → 康复计划",tags:["康复","治疗","药物"]},{id:3,name:"病理分析思维链",icon:"🧬",description:"深度分析：基因检测 → 病理机制 → 分子诊断 → 精准医疗",tags:["病理","基因","精准"]},{id:4,name:"自定义思维链",icon:"⚙️",description:"根据需求自定义推理步骤和规则",tags:["自定义"]}]}},mounted(){this.initializeVisualization()},methods:{goBack(){this.$router.push("/patient-workbench")},async initializeVisualization(){await this.loadD3Scripts(),this.initGraph(),await this.loadFullGraph()},loadD3Scripts(){return new Promise(t=>{if(window.d3){this.loadForceGraphScript(t);return}const e=document.createElement("script");e.src="https://d3js.org/d3.v7.min.js",e.onload=()=>{this.loadForceGraphScript(t)},document.head.appendChild(e)})},loadForceGraphScript(t){if(window.ForceGraph){t();return}const e=document.createElement("script");e.src="https://unpkg.com/force-graph",e.onload=()=>t(),document.head.appendChild(e)},showError(t){this.error=t,setTimeout(()=>{this.error=null},5e3)},setLoading(t){this.loading=t},initGraph(){if(!this.$refs.graph||!window.ForceGraph)return;const t=this.$refs.graph;this.Graph=window.ForceGraph()(t).nodeId("id").nodeLabel("name").nodeVal("value").nodeAutoColorBy("type").nodeCanvasObject((e,a,l)=>{const r=e.name,h=Math.max(12,14/l);a.font=`${h}px Sans-Serif`;const c=[a.measureText(r).width,h].map(w=>w+h*.2);let v;switch(e.type){case"症状":v="#e74c3c";break;case"疾病":v="#3498db";break;case"治疗方法":v="#f39c12";break;case"药物":v="#9b59b6";break;default:v="#95a5a6"}const C=Math.max(5,8/l);a.fillStyle=v,a.beginPath(),a.arc(e.x,e.y,C,0,2*Math.PI,!1),a.fill(),a.fillStyle="rgba(255, 255, 255, 0.8)",a.fillRect(e.x-c[0]/2,e.y-c[1]/2,...c),a.textAlign="center",a.textBaseline="middle",a.fillStyle="#000",a.fillText(r,e.x,e.y)}).linkLabel("relationship").linkDirectionalParticles(2).linkDirectionalParticleSpeed(.005).onNodeClick((e,a)=>{this.showNodeInfo(e,a)}).onBackgroundClick(()=>{this.$refs.nodeInfo&&(this.$refs.nodeInfo.style.display="none")}),this.Graph.graphData({nodes:[],links:[]})},showNodeInfo(t,e){const a=this.$refs.nodeInfo;if(!a)return;let l=`<h3>${t.name}</h3><p>类型: ${t.type}</p>`;if(t.properties){l+="<p>属性:</p><ul>";for(const[r,h]of Object.entries(t.properties))["id","labels","elementId"].includes(r)||(l+=`<li>${r}: ${h}</li>`);l+="</ul>"}a.innerHTML=l,a.style.display="block",a.style.left=`${e.pageX+10}px`,a.style.top=`${e.pageY+10}px`},async loadFullGraph(){try{this.setLoading(!0);const t=await fetch(`${this.API_BASE}/graph/all`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();e.nodes&&e.links&&this.Graph&&(this.nodeCount=e.nodes.length,this.linkCount=e.links.length,this.Graph.graphData(e))}catch(t){console.error("获取全图失败:",t),this.showError(`加载全图失败: ${t.message}`)}finally{this.setLoading(!1)}},async refreshGraph(){await this.loadFullGraph()},selectTemplate(t){this.selectedTemplate=t;const e=this.chainTemplates.find(a=>a.id===t);e&&console.log("选择思维链模板:",e.name)},handleContentUpdate(){console.log("打开内容更新界面"),alert("内容更新功能开发中...")},handleKnowledgeDiscovery(){console.log("打开知识发现界面"),alert("知识发现功能开发中...")},handleInformationReview(){console.log("打开信息审核界面"),alert("信息审核功能开发中...")}}}),B={class:"knowledge-base-container"},S={class:"page-header"},L={class:"header-actions"},M={class:"main-content"},$={class:"graph-section"},G={class:"section-header"},T={class:"stats"},I={class:"stat-item"},V={class:"stat-item"},D={key:0,class:"error"},F={key:1,class:"loading"},E={class:"visualization"},H={ref:"graph",class:"graph-container"},P={ref:"nodeInfo",class:"node-info",style:{display:"none"}},N={class:"right-sections"},A={class:"chain-section"},_={class:"chain-content"},j={class:"template-grid"},R=["onClick"],K={class:"template-icon"},U={class:"template-info"},O={key:0,class:"template-tags"},W={key:0,class:"template-check"},X={class:"maintenance-section"},Y={class:"maintenance-content"},q={class:"maintenance-grid"};function x(t,e,a,l,r,h){return o(),n("div",B,[s("header",S,[s("button",{class:"btn-back",onClick:e[0]||(e[0]=(...i)=>t.goBack&&t.goBack(...i))},[...e[5]||(e[5]=[s("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[s("path",{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8c-16.4 12.8-16.4 37.5 0 50.3l450.8 352.1c5.2 4.1 12.9 0.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z",fill:"currentColor"})],-1),p(" 返回主页 ",-1)])]),e[7]||(e[7]=s("h1",null,"知识库浏览",-1)),s("div",L,[s("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=(...i)=>t.refreshGraph&&t.refreshGraph(...i))},[...e[6]||(e[6]=[s("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"16",height:"16"},[s("path",{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.1-.7-8.5-4.9-9.8l-63.5-22.6c-4.1-1.5-8.6.6-10.2 4.6C788.1 776.1 662.2 872 521.9 872c-192.5 0-349.9-157.4-350.1-349.9C171.6 329.6 329.1 172 521.9 172c99.9 0 184.7 41.6 246.7 108.2l-63.9 49.9c-4.1 3.2-4.9 9-.9 12.9 2.1 2.1 5 3.2 7.9 3.2h250.3c4.2 0 7.6-3.4 7.6-7.6V82.9c0-6.5-7.8-9.9-12.6-5.6z",fill:"currentColor"})],-1),p(" 刷新图谱 ",-1)])])])]),s("div",M,[s("section",$,[s("div",G,[e[10]||(e[10]=s("h2",null," 全局知识图谱 ",-1)),s("div",T,[s("span",I,[e[8]||(e[8]=p("节点: ",-1)),s("strong",null,d(t.nodeCount),1)]),s("span",V,[e[9]||(e[9]=p("关系: ",-1)),s("strong",null,d(t.linkCount),1)])])]),t.error?(o(),n("div",D,d(t.error),1)):g("",!0),t.loading?(o(),n("div",F,[...e[11]||(e[11]=[s("div",{class:"spinner"},null,-1),s("p",null,"正在加载知识图谱...",-1)])])):g("",!0),s("div",E,[s("div",H,null,512),e[12]||(e[12]=u('<div class="legend" data-v-379c049e><div class="legend-item" data-v-379c049e><div class="legend-color" style="background-color:#e74c3c;" data-v-379c049e></div><span data-v-379c049e>症状</span></div><div class="legend-item" data-v-379c049e><div class="legend-color" style="background-color:#3498db;" data-v-379c049e></div><span data-v-379c049e>疾病</span></div><div class="legend-item" data-v-379c049e><div class="legend-color" style="background-color:#f39c12;" data-v-379c049e></div><span data-v-379c049e>治疗方法</span></div><div class="legend-item" data-v-379c049e><div class="legend-color" style="background-color:#9b59b6;" data-v-379c049e></div><span data-v-379c049e>药物</span></div></div>',1))]),s("div",P,null,512)]),s("div",N,[s("section",A,[e[15]||(e[15]=s("div",{class:"section-header"},[s("h2",null,[s("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"18",height:"18"},[s("path",{d:"M924.8 385.6c-22.6-53.4-54.9-101.3-96-142.4-41.1-41.1-89-73.4-142.4-96C631.1 123.8 572.5 112 512 112s-119.1 11.8-174.4 35.2c-53.4 22.6-101.3 54.9-142.4 96-41.1 41.1-73.4 89-96 142.4C75.8 440.9 64 499.5 64 560c0 132.7 58.3 257.7 159.9 343.1l1.7 1.4c5.8 4.8 13.1 7.5 20.6 7.5h531.7c7.5 0 14.8-2.7 20.6-7.5l1.7-1.4C901.7 817.7 960 692.7 960 560c0-60.5-11.9-119.1-35.2-174.4zM761.4 836H262.6C184.4 765.5 140 665.6 140 560c0-99.4 38.7-192.8 109-263 70.3-70.3 163.7-109 263-109 99.4 0 192.8 38.7 263 109 70.3 70.3 109 163.7 109 263 0 105.6-44.4 205.5-122.6 276z",fill:"currentColor"}),s("path",{d:"M623.5 421.5c-3.1-3.1-8.2-3.1-11.3 0L527.7 506c-18.7-5-39.4-.2-54.1 14.5-21.9 21.9-21.9 57.3 0 79.2 21.9 21.9 57.3 21.9 79.2 0 14.7-14.7 19.5-35.4 14.5-54.1l84.5-84.5c3.1-3.1 3.1-8.2 0-11.3l-28.3-28.3zM490 320h44c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8h-44c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8z",fill:"currentColor"})]),p(" 思维链定制 ")])],-1)),s("div",_,[e[14]||(e[14]=s("div",{class:"chain-description"},[s("p",null,"选择预设的诊断推理流程，快速构建符合临床实践的思维链")],-1)),s("div",j,[(o(!0),n(f,null,m(t.chainTemplates,i=>(o(),n("div",{key:i.id,class:b(["template-card",{active:t.selectedTemplate===i.id}]),onClick:c=>t.selectTemplate(i.id)},[s("div",K,d(i.icon),1),s("div",U,[s("h4",null,d(i.name),1),s("p",null,d(i.description),1),i.tags?(o(),n("div",O,[(o(!0),n(f,null,m(i.tags,c=>(o(),n("span",{key:c,class:"tag"},d(c),1))),128))])):g("",!0)]),t.selectedTemplate===i.id?(o(),n("div",W,[...e[13]||(e[13]=[s("svg",{viewBox:"0 0 1024 1024",width:"20",height:"20"},[s("path",{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474c-6.1-7.7-15.3-12.2-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1 0.4-12.8-6.3-12.8z",fill:"currentColor"})],-1)])])):g("",!0)],10,R))),128))])])]),s("section",X,[e[19]||(e[19]=s("div",{class:"section-header"},[s("h2",null,[s("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"18",height:"18"},[s("path",{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zM513.1 518.1l-192 161c-5.2 4.4-13.1.7-13.1-6.1v-62.7c0-2.3 1.1-4.6 2.9-6.1L420.7 512l-109.8-92.2c-1.8-1.5-2.9-3.8-2.9-6.1V351c0-6.8 7.9-10.5 13.1-6.1l192 160.9c3.9 3.2 3.9 9.1 0 12.3zM716 673c0 4.4-3.4 8-7.5 8h-185c-4.1 0-7.5-3.6-7.5-8v-48c0-4.4 3.4-8 7.5-8h185c4.1 0 7.5 3.6 7.5 8v48z",fill:"currentColor"})]),p(" 知识库维护 ")])],-1)),s("div",Y,[s("div",q,[s("div",{class:"maintenance-card",onClick:e[2]||(e[2]=(...i)=>t.handleContentUpdate&&t.handleContentUpdate(...i))},[...e[16]||(e[16]=[u('<div class="card-icon update" data-v-379c049e><svg viewBox="0 0 1024 1024" width="28" height="28" data-v-379c049e><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-80 600c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V360c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v304zm200-176V360c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v128c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8zm0 176c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v48z" fill="currentColor" data-v-379c049e></path></svg></div><div class="card-content" data-v-379c049e><h3 data-v-379c049e>内容更新</h3><p data-v-379c049e>同步最新医学知识、更新疾病信息、添加新的症状关联</p><div class="card-stats" data-v-379c049e><span class="stat" data-v-379c049e><svg viewBox="0 0 1024 1024" width="14" height="14" data-v-379c049e><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm176.5 585.7l-28.6 39c-3.8 5.3-11.4 6.1-16.4 1.8L512 586.9l-131.5 103.6c-5 3.9-12.6 3.1-16.4-1.8l-28.6-39c-3.8-5.1-3.3-12.4 1.4-16.9l155.8-147.2-155.8-147.2c-4.7-4.4-5.2-11.7-1.4-16.9l28.6-39c3.8-5.3 11.4-6.1 16.4-1.8L512 385.1l131.5-103.6c5-3.9 12.6-3.1 16.4 1.8l28.6 39c3.8 5.1 3.3 12.4-1.4 16.9L531.3 486.4l155.8 147.2c4.6 4.5 5.1 11.8 1.4 16.9z" fill="currentColor" data-v-379c049e></path></svg> 待更新: 23 </span></div></div>',2)])]),s("div",{class:"maintenance-card",onClick:e[3]||(e[3]=(...i)=>t.handleKnowledgeDiscovery&&t.handleKnowledgeDiscovery(...i))},[...e[17]||(e[17]=[u('<div class="card-icon discovery" data-v-379c049e><svg viewBox="0 0 1024 1024" width="28" height="28" data-v-379c049e><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6c3.2 3.2 8.4 3.2 11.6 0l43.6-43.5c3.2-3.2 3.2-8.4 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z" fill="currentColor" data-v-379c049e></path></svg></div><div class="card-content" data-v-379c049e><h3 data-v-379c049e>知识发现</h3><p data-v-379c049e>从病历数据中挖掘新的疾病-症状关联模式</p><div class="card-stats" data-v-379c049e><span class="stat" data-v-379c049e><svg viewBox="0 0 1024 1024" width="14" height="14" data-v-379c049e><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292c-12.7 17.7-39 17.7-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z" fill="currentColor" data-v-379c049e></path></svg> 新发现: 8 </span></div></div>',2)])]),s("div",{class:"maintenance-card",onClick:e[4]||(e[4]=(...i)=>t.handleInformationReview&&t.handleInformationReview(...i))},[...e[18]||(e[18]=[u('<div class="card-icon review" data-v-379c049e><svg viewBox="0 0 1024 1024" width="28" height="28" data-v-379c049e><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292c-12.7 17.7-39 17.7-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z" fill="currentColor" data-v-379c049e></path></svg></div><div class="card-content" data-v-379c049e><h3 data-v-379c049e>信息审核</h3><p data-v-379c049e>审核新增知识条目、验证数据准确性、管理知识质量</p><div class="card-stats" data-v-379c049e><span class="stat" data-v-379c049e><svg viewBox="0 0 1024 1024" width="14" height="14" data-v-379c049e><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359c-1.2-1.5-1.9-3.3-1.9-5.2 0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130.1 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z" fill="currentColor" data-v-379c049e></path></svg> 待审核: 15 </span></div></div>',2)])])])])])])])])}const Q=k(z,[["render",x],["__scopeId","data-v-379c049e"]]);export{Q as default};
